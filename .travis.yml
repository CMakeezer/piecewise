sudo: required

os:
  - linux
  - osx

language:
  - cpp

arch:
  #repos:
  packages:
    # pacman packages
    - meson
    - clang
    - ninja
    # aur packages
  script:
    - mkdir build_sanitizer
    - CXX=clang++ meson build_sanitizer -Db_sanitize=address
    - mesontest -C build_sanitizer
    - mkdir build_clang
    - CXX=clang++ meson build_clang --buildtype=release
    - mesontest -C build_clang
    - mkdir build_gcc
    - CXX=g++ meson build_gcc --buildtype=release
    - mesontest -C build_gcc

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install ninja python3; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pip3 install meson; fi

script:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then curl -s https://raw.githubusercontent.com/mikkeloscar/arch-travis/master/arch-travis.sh | bash; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then SDKROOT=$(xcodebuild -version -sdk macosx Path) mkdir build && meson build && mesontest -C build; fi

